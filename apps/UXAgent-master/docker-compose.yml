version: '3.8'

services:
  # UXAgent Backend API
  uxagent:
    build: .
    ports:
      - "8000:8000"
    environment:
      # Browser mode - set to "browserbase" for cloud sessions
      - BROWSER_MODE=${BROWSER_MODE:-browserbase}
      # BrowserBase credentials
      - BROWSERBASE_API_KEY=${BROWSERBASE_API_KEY}
      - BROWSERBASE_PROJECT_ID=${BROWSERBASE_PROJECT_ID}
      # LLM API key (Anthropic by default)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # Optional: OpenAI or AWS
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
    volumes:
      # Persist experiment results
      - ./runs:/app/runs
    restart: unless-stopped

  # Experiment Configuration UI (Vue.js + Vite)
  experiment-ui:
    build:
      context: ./experiment-ui
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=http://uxagent:8000
    depends_on:
      - uxagent

# Optional: Add Nginx reverse proxy for production
#  nginx:
#    image: nginx:alpine
#    ports:
#      - "80:80"
#    volumes:
#      - ./nginx.conf:/etc/nginx/nginx.conf:ro
#    depends_on:
#      - uxagent
#      - experiment-ui
